<!-- CODE IN PRODUCTION TESTS - DO NOT CHANGE -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript"
            src="https://static.parastorage.com/services/js-sdk/1.94.0/js/wix-private.js"></script>

  </head>
  <body>
    <h1 id="header">My TPA App 1</h1>
    <button onclick="handleClick">CLICK HERE</button>

  </body>
</html>

<script>

    let viewerScriptAPI;

    function openPopUp(url) {
        Wix.openPopup(url, 300, 300);
    }

    init();
    Wix.addEventListener(Wix.Events.EDIT_MODE_CHANGE, function(event) {
        console.log("Edit mode changed to " + event.editMode);
        if (event.editMode === 'preview') {
            init();
        }
    });


    function handleClick() {
        viewerScriptAPI.fireEvent();
        console.log("Button Clicked");
    }

    function init() {
        Wix.getPublicAPI({appDefinitionId: "151ae411-99f6-2f8f-cee7-6fe5e50f7a7e"}, function (api) {
            setTimeout(() => viewerScriptAPI.fireEvent(), 1000);
            viewerScriptAPI = api;
            api.registerOpenPopUpFunction(openPopUp);
            api.tpaIsReady();
            Wix.getComponentInfo(function (info) {
                const compId = info.compId;
                console.log(api);
            });
        }, function (error) {
            console.log(error);
        });
    }

</script>


<!-- CODE IN PRODUCTION TESTS - DO NOT CHANGE -->


